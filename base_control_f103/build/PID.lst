ARM GAS  C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s 			page 1


   1              		.cpu cortex-m3
   2              		.eabi_attribute 20, 1
   3              		.eabi_attribute 21, 1
   4              		.eabi_attribute 23, 3
   5              		.eabi_attribute 24, 1
   6              		.eabi_attribute 25, 1
   7              		.eabi_attribute 26, 1
   8              		.eabi_attribute 30, 1
   9              		.eabi_attribute 34, 1
  10              		.eabi_attribute 18, 4
  11              		.file	"PID.c"
  12              		.text
  13              	.Ltext0:
  14              		.cfi_sections	.debug_frame
  15              		.global	__aeabi_ui2f
  16              		.global	__aeabi_fmul
  17              		.global	__aeabi_f2d
  18              		.global	__aeabi_ddiv
  19              		.global	__aeabi_dmul
  20              		.section	.text.PID_ComputeSpeedRPM,"ax",%progbits
  21              		.align	1
  22              		.global	PID_ComputeSpeedRPM
  23              		.arch armv7-m
  24              		.syntax unified
  25              		.thumb
  26              		.thumb_func
  27              		.fpu softvfp
  29              	PID_ComputeSpeedRPM:
  30              	.LVL0:
  31              	.LFB65:
  32              		.file 1 "Core/Src/PID.c"
   1:Core/Src/PID.c **** /*
   2:Core/Src/PID.c **** *   File name: PID.c
   3:Core/Src/PID.c **** *   Author: Linh Nguyen
   4:Core/Src/PID.c **** *   Last modified: 1/6/2021
   5:Core/Src/PID.c **** *   Description: This contains all interface functions for PID controlling motors
   6:Core/Src/PID.c **** */
   7:Core/Src/PID.c **** 
   8:Core/Src/PID.c **** #include "PID.h"
   9:Core/Src/PID.c **** #include "string.h"
  10:Core/Src/PID.c **** #include "math.h"
  11:Core/Src/PID.c **** #include "config.h"
  12:Core/Src/PID.c **** #include "gpio.h"
  13:Core/Src/PID.c **** #include "stm32f1xx_hal_def.h"
  14:Core/Src/PID.c **** 
  15:Core/Src/PID.c **** // volatile double i_term;
  16:Core/Src/PID.c **** // volatile double p_term;
  17:Core/Src/PID.c **** // volatile double d_term;
  18:Core/Src/PID.c **** 
  19:Core/Src/PID.c **** 
  20:Core/Src/PID.c **** #ifdef ENABLE_PID
  21:Core/Src/PID.c **** /* Private function prototypes*/
  22:Core/Src/PID.c **** 
  23:Core/Src/PID.c **** double PID_Limit(double input, double max, double min);
  24:Core/Src/PID.c **** 
  25:Core/Src/PID.c **** 
  26:Core/Src/PID.c **** 
ARM GAS  C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s 			page 2


  27:Core/Src/PID.c **** 
  28:Core/Src/PID.c **** // Convert encoder pulses count to speed in RPM, tick in milisecond
  29:Core/Src/PID.c **** void PID_ComputeSpeedRPM(MOTOR_TypeDef *motor, uint32_t tick)
  30:Core/Src/PID.c **** { 
  33              		.loc 1 30 1 view -0
  34              		.cfi_startproc
  35              		@ args = 0, pretend = 0, frame = 0
  36              		@ frame_needed = 0, uses_anonymous_args = 0
  37              		.loc 1 30 1 is_stmt 0 view .LVU1
  38 0000 D0B5     		push	{r4, r6, r7, lr}
  39              	.LCFI0:
  40              		.cfi_def_cfa_offset 16
  41              		.cfi_offset 4, -16
  42              		.cfi_offset 6, -12
  43              		.cfi_offset 7, -8
  44              		.cfi_offset 14, -4
  45 0002 0446     		mov	r4, r0
  31:Core/Src/PID.c ****     motor->speed = ((motor->measure) / (MOTOR_PPR * tick))*60000;
  46              		.loc 1 31 5 is_stmt 1 view .LVU2
  47              		.loc 1 31 27 is_stmt 0 view .LVU3
  48 0004 D0E90467 		ldrd	r6, [r0, #16]
  49              		.loc 1 31 51 view .LVU4
  50 0008 0846     		mov	r0, r1
  51              	.LVL1:
  52              		.loc 1 31 51 view .LVU5
  53 000a FFF7FEFF 		bl	__aeabi_ui2f
  54              	.LVL2:
  55              		.loc 1 31 51 view .LVU6
  56 000e 0C49     		ldr	r1, .L3+8
  57 0010 FFF7FEFF 		bl	__aeabi_fmul
  58              	.LVL3:
  59 0014 FFF7FEFF 		bl	__aeabi_f2d
  60              	.LVL4:
  61 0018 0246     		mov	r2, r0
  62 001a 0B46     		mov	r3, r1
  63              		.loc 1 31 38 view .LVU7
  64 001c 3046     		mov	r0, r6
  65 001e 3946     		mov	r1, r7
  66 0020 FFF7FEFF 		bl	__aeabi_ddiv
  67              	.LVL5:
  68              		.loc 1 31 59 view .LVU8
  69 0024 04A3     		adr	r3, .L3
  70 0026 D3E90023 		ldrd	r2, [r3]
  71 002a FFF7FEFF 		bl	__aeabi_dmul
  72              	.LVL6:
  73              		.loc 1 31 18 view .LVU9
  74 002e C4E90001 		strd	r0, [r4]
  32:Core/Src/PID.c **** }
  75              		.loc 1 32 1 view .LVU10
  76 0032 D0BD     		pop	{r4, r6, r7, pc}
  77              	.LVL7:
  78              	.L4:
  79              		.loc 1 32 1 view .LVU11
  80 0034 AFF30080 		.align	3
  81              	.L3:
  82 0038 00000000 		.word	0
  83 003c 004CED40 		.word	1089293312
ARM GAS  C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s 			page 3


  84 0040 00004844 		.word	1145569280
  85              		.cfi_endproc
  86              	.LFE65:
  88              		.global	__aeabi_dcmpge
  89              		.section	.text.PID_SetSpeedRPM,"ax",%progbits
  90              		.align	1
  91              		.global	PID_SetSpeedRPM
  92              		.syntax unified
  93              		.thumb
  94              		.thumb_func
  95              		.fpu softvfp
  97              	PID_SetSpeedRPM:
  98              	.LVL8:
  99              	.LFB66:
  33:Core/Src/PID.c **** 
  34:Core/Src/PID.c **** void PID_SetSpeedRPM(MOTOR_TypeDef *motor, double _set_speed)
  35:Core/Src/PID.c **** {
 100              		.loc 1 35 1 is_stmt 1 view -0
 101              		.cfi_startproc
 102              		@ args = 0, pretend = 0, frame = 0
 103              		@ frame_needed = 0, uses_anonymous_args = 0
 104              		.loc 1 35 1 is_stmt 0 view .LVU13
 105 0000 70B5     		push	{r4, r5, r6, lr}
 106              	.LCFI1:
 107              		.cfi_def_cfa_offset 16
 108              		.cfi_offset 4, -16
 109              		.cfi_offset 5, -12
 110              		.cfi_offset 6, -8
 111              		.cfi_offset 14, -4
 112 0002 0646     		mov	r6, r0
 113 0004 1446     		mov	r4, r2
 114 0006 1D46     		mov	r5, r3
  36:Core/Src/PID.c ****     if (_set_speed >= 0) 
 115              		.loc 1 36 5 is_stmt 1 view .LVU14
 116              		.loc 1 36 8 is_stmt 0 view .LVU15
 117 0008 0022     		movs	r2, #0
 118              	.LVL9:
 119              		.loc 1 36 8 view .LVU16
 120 000a 0023     		movs	r3, #0
 121 000c 2046     		mov	r0, r4
 122              	.LVL10:
 123              		.loc 1 36 8 view .LVU17
 124 000e 2946     		mov	r1, r5
 125 0010 FFF7FEFF 		bl	__aeabi_dcmpge
 126              	.LVL11:
 127 0014 28B1     		cbz	r0, .L10
  37:Core/Src/PID.c ****     {
  38:Core/Src/PID.c ****         motor->dir = 1;
 128              		.loc 1 38 9 is_stmt 1 view .LVU18
 129              		.loc 1 38 20 is_stmt 0 view .LVU19
 130 0016 0123     		movs	r3, #1
 131 0018 86F82830 		strb	r3, [r6, #40]
  39:Core/Src/PID.c ****         motor->set_speed = _set_speed;
 132              		.loc 1 39 9 is_stmt 1 view .LVU20
 133              		.loc 1 39 26 is_stmt 0 view .LVU21
 134 001c C6E90245 		strd	r4, [r6, #8]
 135              	.L5:
ARM GAS  C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s 			page 4


  40:Core/Src/PID.c ****     } 
  41:Core/Src/PID.c ****     else 
  42:Core/Src/PID.c ****     {
  43:Core/Src/PID.c ****         motor->dir = 0;
  44:Core/Src/PID.c ****         motor->set_speed = - (_set_speed);
  45:Core/Src/PID.c ****     }    
  46:Core/Src/PID.c **** }
 136              		.loc 1 46 1 view .LVU22
 137 0020 70BD     		pop	{r4, r5, r6, pc}
 138              	.LVL12:
 139              	.L10:
  43:Core/Src/PID.c ****         motor->set_speed = - (_set_speed);
 140              		.loc 1 43 9 is_stmt 1 view .LVU23
  43:Core/Src/PID.c ****         motor->set_speed = - (_set_speed);
 141              		.loc 1 43 20 is_stmt 0 view .LVU24
 142 0022 0023     		movs	r3, #0
 143 0024 86F82830 		strb	r3, [r6, #40]
  44:Core/Src/PID.c ****     }    
 144              		.loc 1 44 9 is_stmt 1 view .LVU25
  44:Core/Src/PID.c ****     }    
 145              		.loc 1 44 28 is_stmt 0 view .LVU26
 146 0028 2246     		mov	r2, r4
 147 002a 05F10043 		add	r3, r5, #-2147483648
  44:Core/Src/PID.c ****     }    
 148              		.loc 1 44 26 view .LVU27
 149 002e C6E90223 		strd	r2, [r6, #8]
 150              		.loc 1 46 1 view .LVU28
 151 0032 F5E7     		b	.L5
 152              		.cfi_endproc
 153              	.LFE66:
 155              		.global	__aeabi_i2d
 156              		.section	.text.PID_SetSpeedMPS,"ax",%progbits
 157              		.align	1
 158              		.global	PID_SetSpeedMPS
 159              		.syntax unified
 160              		.thumb
 161              		.thumb_func
 162              		.fpu softvfp
 164              	PID_SetSpeedMPS:
 165              	.LVL13:
 166              	.LFB67:
  47:Core/Src/PID.c **** 
  48:Core/Src/PID.c **** // Convert speed in M/S to RPM and write to SET SPEED
  49:Core/Src/PID.c **** void PID_SetSpeedMPS(MOTOR_TypeDef *motor, int16_t _set_speed_mps)
  50:Core/Src/PID.c **** {
 167              		.loc 1 50 1 is_stmt 1 view -0
 168              		.cfi_startproc
 169              		@ args = 0, pretend = 0, frame = 0
 170              		@ frame_needed = 0, uses_anonymous_args = 0
 171              		.loc 1 50 1 is_stmt 0 view .LVU30
 172 0000 10B5     		push	{r4, lr}
 173              	.LCFI2:
 174              		.cfi_def_cfa_offset 8
 175              		.cfi_offset 4, -8
 176              		.cfi_offset 14, -4
 177 0002 0446     		mov	r4, r0
  51:Core/Src/PID.c ****     double speed_rps = _set_speed_mps / (PI * ROBOT_WHEEL_DIAMETER);
ARM GAS  C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s 			page 5


 178              		.loc 1 51 5 is_stmt 1 view .LVU31
 179              		.loc 1 51 39 is_stmt 0 view .LVU32
 180 0004 0846     		mov	r0, r1
 181              	.LVL14:
 182              		.loc 1 51 39 view .LVU33
 183 0006 FFF7FEFF 		bl	__aeabi_i2d
 184              	.LVL15:
 185              		.loc 1 51 12 view .LVU34
 186 000a 07A3     		adr	r3, .L14
 187 000c D3E90023 		ldrd	r2, [r3]
 188 0010 FFF7FEFF 		bl	__aeabi_ddiv
 189              	.LVL16:
  52:Core/Src/PID.c ****     motor->set_speed = (double)(speed_rps) * 60;
 190              		.loc 1 52 5 is_stmt 1 view .LVU35
 191              		.loc 1 52 44 is_stmt 0 view .LVU36
 192 0014 0022     		movs	r2, #0
 193 0016 064B     		ldr	r3, .L14+8
 194 0018 FFF7FEFF 		bl	__aeabi_dmul
 195              	.LVL17:
 196              		.loc 1 52 22 view .LVU37
 197 001c C4E90201 		strd	r0, [r4, #8]
  53:Core/Src/PID.c **** }
 198              		.loc 1 53 1 view .LVU38
 199 0020 10BD     		pop	{r4, pc}
 200              	.LVL18:
 201              	.L15:
 202              		.loc 1 53 1 view .LVU39
 203 0022 00BFAFF3 		.align	3
 203      0080
 204              	.L14:
 205 0028 DCE14F3D 		.word	1028645340
 206 002c 5723CA3F 		.word	1070211927
 207 0030 00004E40 		.word	1078853632
 208              		.cfi_endproc
 209              	.LFE67:
 211              		.global	__aeabi_dsub
 212              		.section	.text.PID_ComputeError,"ax",%progbits
 213              		.align	1
 214              		.global	PID_ComputeError
 215              		.syntax unified
 216              		.thumb
 217              		.thumb_func
 218              		.fpu softvfp
 220              	PID_ComputeError:
 221              	.LVL19:
 222              	.LFB68:
  54:Core/Src/PID.c **** 
  55:Core/Src/PID.c **** /*
  56:Core/Src/PID.c **** *  Note:
  57:Core/Src/PID.c **** */
  58:Core/Src/PID.c **** void PID_ComputeError(MOTOR_TypeDef *motor)
  59:Core/Src/PID.c **** {
 223              		.loc 1 59 1 is_stmt 1 view -0
 224              		.cfi_startproc
 225              		@ args = 0, pretend = 0, frame = 0
 226              		@ frame_needed = 0, uses_anonymous_args = 0
 227              		.loc 1 59 1 is_stmt 0 view .LVU41
ARM GAS  C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s 			page 6


 228 0000 10B5     		push	{r4, lr}
 229              	.LCFI3:
 230              		.cfi_def_cfa_offset 8
 231              		.cfi_offset 4, -8
 232              		.cfi_offset 14, -4
 233 0002 0346     		mov	r3, r0
  60:Core/Src/PID.c ****     motor->pPID_params->error = (motor->set_speed) - (motor->speed);
 234              		.loc 1 60 5 is_stmt 1 view .LVU42
 235              		.loc 1 60 39 is_stmt 0 view .LVU43
 236 0004 00F10801 		add	r1, r0, #8
 237 0008 D1E90001 		ldrd	r0, [r1]
 238              	.LVL20:
 239              		.loc 1 60 10 view .LVU44
 240 000c 1C6B     		ldr	r4, [r3, #48]
 241              		.loc 1 60 52 view .LVU45
 242 000e D3E90023 		ldrd	r2, [r3]
 243 0012 FFF7FEFF 		bl	__aeabi_dsub
 244              	.LVL21:
 245              		.loc 1 60 31 view .LVU46
 246 0016 C4E90601 		strd	r0, [r4, #24]
  61:Core/Src/PID.c **** }
 247              		.loc 1 61 1 view .LVU47
 248 001a 10BD     		pop	{r4, pc}
 249              		.cfi_endproc
 250              	.LFE68:
 252              		.global	__aeabi_dcmpgt
 253              		.global	__aeabi_dcmplt
 254              		.section	.text.PID_Limit,"ax",%progbits
 255              		.align	1
 256              		.global	PID_Limit
 257              		.syntax unified
 258              		.thumb
 259              		.thumb_func
 260              		.fpu softvfp
 262              	PID_Limit:
 263              	.LVL22:
 264              	.LFB70:
  62:Core/Src/PID.c **** 
  63:Core/Src/PID.c **** /*
  64:Core/Src/PID.c **** *  Note: 
  65:Core/Src/PID.c **** */
  66:Core/Src/PID.c **** void PID_ComputeOutput(MOTOR_TypeDef *motor)
  67:Core/Src/PID.c **** {   
  68:Core/Src/PID.c ****     double i_term;
  69:Core/Src/PID.c ****     double p_term;
  70:Core/Src/PID.c **** 
  71:Core/Src/PID.c ****     double output = 0.0f;
  72:Core/Src/PID.c ****     double _OUTPUT_MAX = motor->pPID_params->OUTPUT_MAX;
  73:Core/Src/PID.c ****     double _OUTPUT_MIN =motor->pPID_params->OUTPUT_MIN;
  74:Core/Src/PID.c **** 
  75:Core/Src/PID.c ****     PID_TypeDef *PID ;
  76:Core/Src/PID.c ****     PID = motor->pPID_params;
  77:Core/Src/PID.c **** 
  78:Core/Src/PID.c ****     p_term = PID->Kp*(PID->error);
  79:Core/Src/PID.c **** 
  80:Core/Src/PID.c ****     // Compute upper limit of Integration Term 
  81:Core/Src/PID.c ****     float i_term_max, i_term_min;
ARM GAS  C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s 			page 7


  82:Core/Src/PID.c ****     if (PID->OUTPUT_MAX > p_term)
  83:Core/Src/PID.c ****     {
  84:Core/Src/PID.c ****         i_term_max = PID->OUTPUT_MAX - p_term;
  85:Core/Src/PID.c ****     } 
  86:Core/Src/PID.c ****     else 
  87:Core/Src/PID.c ****     {
  88:Core/Src/PID.c ****         i_term_max = 0.0f;
  89:Core/Src/PID.c ****     }
  90:Core/Src/PID.c ****     // Compute lower limit of Integration Term
  91:Core/Src/PID.c ****     if (PID->OUTPUT_MIN < p_term)
  92:Core/Src/PID.c ****     {
  93:Core/Src/PID.c ****         i_term_min = PID->OUTPUT_MIN - p_term ;
  94:Core/Src/PID.c ****     } 
  95:Core/Src/PID.c ****     else 
  96:Core/Src/PID.c ****     {
  97:Core/Src/PID.c ****         i_term_min = 0.0f;
  98:Core/Src/PID.c ****     }
  99:Core/Src/PID.c **** 
 100:Core/Src/PID.c ****     i_term = PID->last_i +  PID->Ki * ( (PID->error) + (PID->previous_error) );
 101:Core/Src/PID.c ****     // i_term = PID_Limit(i_term, i_term_max, i_term_min);
 102:Core/Src/PID.c ****     
 103:Core/Src/PID.c ****     output = p_term + i_term;
 104:Core/Src/PID.c ****     output = PID_Limit(output, _OUTPUT_MAX, _OUTPUT_MIN);
 105:Core/Src/PID.c ****     
 106:Core/Src/PID.c ****     motor->pwm_output = (output < 0) ? -output : output;
 107:Core/Src/PID.c ****     PID->previous_error = PID->error;
 108:Core/Src/PID.c ****     PID->last_i = i_term;
 109:Core/Src/PID.c **** }
 110:Core/Src/PID.c **** 
 111:Core/Src/PID.c **** // Limit the signal in range (max,min)
 112:Core/Src/PID.c **** double PID_Limit(double input, double max, double min)
 113:Core/Src/PID.c **** {
 265              		.loc 1 113 1 is_stmt 1 view -0
 266              		.cfi_startproc
 267              		@ args = 8, pretend = 0, frame = 0
 268              		@ frame_needed = 0, uses_anonymous_args = 0
 269              		.loc 1 113 1 is_stmt 0 view .LVU49
 270 0000 F8B5     		push	{r3, r4, r5, r6, r7, lr}
 271              	.LCFI4:
 272              		.cfi_def_cfa_offset 24
 273              		.cfi_offset 3, -24
 274              		.cfi_offset 4, -20
 275              		.cfi_offset 5, -16
 276              		.cfi_offset 6, -12
 277              		.cfi_offset 7, -8
 278              		.cfi_offset 14, -4
 279 0002 0646     		mov	r6, r0
 280 0004 0F46     		mov	r7, r1
 281 0006 1446     		mov	r4, r2
 282 0008 1D46     		mov	r5, r3
 114:Core/Src/PID.c ****     if (input > max)
 283              		.loc 1 114 5 is_stmt 1 view .LVU50
 284              		.loc 1 114 8 is_stmt 0 view .LVU51
 285 000a FFF7FEFF 		bl	__aeabi_dcmpgt
 286              	.LVL23:
 287              		.loc 1 114 8 view .LVU52
 288 000e 48B9     		cbnz	r0, .L21
ARM GAS  C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s 			page 8


 115:Core/Src/PID.c ****     {
 116:Core/Src/PID.c ****         return max;
 117:Core/Src/PID.c ****     }
 118:Core/Src/PID.c ****     else if (input < min)
 289              		.loc 1 118 10 is_stmt 1 view .LVU53
 290              		.loc 1 118 13 is_stmt 0 view .LVU54
 291 0010 DDE90623 		ldrd	r2, [sp, #24]
 292 0014 3046     		mov	r0, r6
 293 0016 3946     		mov	r1, r7
 294 0018 FFF7FEFF 		bl	__aeabi_dcmplt
 295              	.LVL24:
 296 001c 28B1     		cbz	r0, .L24
 119:Core/Src/PID.c ****     {
 120:Core/Src/PID.c ****         return min;
 297              		.loc 1 120 16 view .LVU55
 298 001e DDE90601 		ldrd	r0, [sp, #24]
 299 0022 01E0     		b	.L18
 300              	.L21:
 116:Core/Src/PID.c ****     }
 301              		.loc 1 116 16 view .LVU56
 302 0024 2046     		mov	r0, r4
 303 0026 2946     		mov	r1, r5
 304              	.L18:
 121:Core/Src/PID.c ****     }
 122:Core/Src/PID.c ****     else
 123:Core/Src/PID.c ****     {
 124:Core/Src/PID.c ****         return input;
 125:Core/Src/PID.c ****     }
 126:Core/Src/PID.c **** }
 305              		.loc 1 126 1 view .LVU57
 306 0028 F8BD     		pop	{r3, r4, r5, r6, r7, pc}
 307              	.LVL25:
 308              	.L24:
 124:Core/Src/PID.c ****     }
 309              		.loc 1 124 16 view .LVU58
 310 002a 3046     		mov	r0, r6
 311 002c 3946     		mov	r1, r7
 312 002e FBE7     		b	.L18
 313              		.cfi_endproc
 314              	.LFE70:
 316              		.global	__aeabi_dadd
 317              		.section	.text.PID_ComputeOutput,"ax",%progbits
 318              		.align	1
 319              		.global	PID_ComputeOutput
 320              		.syntax unified
 321              		.thumb
 322              		.thumb_func
 323              		.fpu softvfp
 325              	PID_ComputeOutput:
 326              	.LVL26:
 327              	.LFB69:
  67:Core/Src/PID.c ****     double i_term;
 328              		.loc 1 67 1 is_stmt 1 view -0
 329              		.cfi_startproc
 330              		@ args = 0, pretend = 0, frame = 16
 331              		@ frame_needed = 0, uses_anonymous_args = 0
  67:Core/Src/PID.c ****     double i_term;
ARM GAS  C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s 			page 9


 332              		.loc 1 67 1 is_stmt 0 view .LVU60
 333 0000 2DE9F04F 		push	{r4, r5, r6, r7, r8, r9, r10, fp, lr}
 334              	.LCFI5:
 335              		.cfi_def_cfa_offset 36
 336              		.cfi_offset 4, -36
 337              		.cfi_offset 5, -32
 338              		.cfi_offset 6, -28
 339              		.cfi_offset 7, -24
 340              		.cfi_offset 8, -20
 341              		.cfi_offset 9, -16
 342              		.cfi_offset 10, -12
 343              		.cfi_offset 11, -8
 344              		.cfi_offset 14, -4
 345 0004 87B0     		sub	sp, sp, #28
 346              	.LCFI6:
 347              		.cfi_def_cfa_offset 64
 348 0006 0546     		mov	r5, r0
  68:Core/Src/PID.c ****     double p_term;
 349              		.loc 1 68 5 is_stmt 1 view .LVU61
  69:Core/Src/PID.c **** 
 350              		.loc 1 69 5 view .LVU62
  71:Core/Src/PID.c ****     double _OUTPUT_MAX = motor->pPID_params->OUTPUT_MAX;
 351              		.loc 1 71 5 view .LVU63
 352              	.LVL27:
  72:Core/Src/PID.c ****     double _OUTPUT_MIN =motor->pPID_params->OUTPUT_MIN;
 353              		.loc 1 72 5 view .LVU64
  72:Core/Src/PID.c ****     double _OUTPUT_MIN =motor->pPID_params->OUTPUT_MIN;
 354              		.loc 1 72 31 is_stmt 0 view .LVU65
 355 0008 046B     		ldr	r4, [r0, #48]
  72:Core/Src/PID.c ****     double _OUTPUT_MIN =motor->pPID_params->OUTPUT_MIN;
 356              		.loc 1 72 12 view .LVU66
 357 000a D4E910AB 		ldrd	r10, [r4, #64]
 358              	.LVL28:
  73:Core/Src/PID.c **** 
 359              		.loc 1 73 5 is_stmt 1 view .LVU67
  73:Core/Src/PID.c **** 
 360              		.loc 1 73 12 is_stmt 0 view .LVU68
 361 000e D4E91289 		ldrd	r8, [r4, #72]
 362              	.LVL29:
  75:Core/Src/PID.c ****     PID = motor->pPID_params;
 363              		.loc 1 75 5 is_stmt 1 view .LVU69
  76:Core/Src/PID.c **** 
 364              		.loc 1 76 5 view .LVU70
  78:Core/Src/PID.c **** 
 365              		.loc 1 78 5 view .LVU71
  78:Core/Src/PID.c **** 
 366              		.loc 1 78 12 is_stmt 0 view .LVU72
 367 0012 D4E90623 		ldrd	r2, [r4, #24]
 368 0016 D4E90001 		ldrd	r0, [r4]
 369              	.LVL30:
  78:Core/Src/PID.c **** 
 370              		.loc 1 78 12 view .LVU73
 371 001a FFF7FEFF 		bl	__aeabi_dmul
 372              	.LVL31:
 373 001e CDE90401 		strd	r0, [sp, #16]
 374              	.LVL32:
  81:Core/Src/PID.c ****     if (PID->OUTPUT_MAX > p_term)
ARM GAS  C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s 			page 10


 375              		.loc 1 81 5 is_stmt 1 view .LVU74
  82:Core/Src/PID.c ****     {
 376              		.loc 1 82 5 view .LVU75
  91:Core/Src/PID.c ****     {
 377              		.loc 1 91 5 view .LVU76
 100:Core/Src/PID.c ****     // i_term = PID_Limit(i_term, i_term_max, i_term_min);
 378              		.loc 1 100 5 view .LVU77
 100:Core/Src/PID.c ****     // i_term = PID_Limit(i_term, i_term_max, i_term_min);
 379              		.loc 1 100 17 is_stmt 0 view .LVU78
 380 0022 D4E90C67 		ldrd	r6, [r4, #48]
 100:Core/Src/PID.c ****     // i_term = PID_Limit(i_term, i_term_max, i_term_min);
 381              		.loc 1 100 32 view .LVU79
 382 0026 D4E90423 		ldrd	r2, [r4, #16]
 383 002a CDE90223 		strd	r2, [sp, #8]
 100:Core/Src/PID.c ****     // i_term = PID_Limit(i_term, i_term_max, i_term_min);
 384              		.loc 1 100 45 view .LVU80
 385 002e D4E90601 		ldrd	r0, [r4, #24]
 386              	.LVL33:
 100:Core/Src/PID.c ****     // i_term = PID_Limit(i_term, i_term_max, i_term_min);
 387              		.loc 1 100 54 view .LVU81
 388 0032 D4E90823 		ldrd	r2, [r4, #32]
 389 0036 FFF7FEFF 		bl	__aeabi_dadd
 390              	.LVL34:
 391 003a 0246     		mov	r2, r0
 392 003c 0B46     		mov	r3, r1
 100:Core/Src/PID.c ****     // i_term = PID_Limit(i_term, i_term_max, i_term_min);
 393              		.loc 1 100 37 view .LVU82
 394 003e DDE90201 		ldrd	r0, [sp, #8]
 395 0042 FFF7FEFF 		bl	__aeabi_dmul
 396              	.LVL35:
 397 0046 0246     		mov	r2, r0
 398 0048 0B46     		mov	r3, r1
 100:Core/Src/PID.c ****     // i_term = PID_Limit(i_term, i_term_max, i_term_min);
 399              		.loc 1 100 12 view .LVU83
 400 004a 3046     		mov	r0, r6
 401 004c 3946     		mov	r1, r7
 402 004e FFF7FEFF 		bl	__aeabi_dadd
 403              	.LVL36:
 404 0052 0646     		mov	r6, r0
 405 0054 0F46     		mov	r7, r1
 406              	.LVL37:
 103:Core/Src/PID.c ****     output = PID_Limit(output, _OUTPUT_MAX, _OUTPUT_MIN);
 407              		.loc 1 103 5 is_stmt 1 view .LVU84
 103:Core/Src/PID.c ****     output = PID_Limit(output, _OUTPUT_MAX, _OUTPUT_MIN);
 408              		.loc 1 103 12 is_stmt 0 view .LVU85
 409 0056 0246     		mov	r2, r0
 410 0058 0B46     		mov	r3, r1
 411 005a DDE90401 		ldrd	r0, [sp, #16]
 412 005e FFF7FEFF 		bl	__aeabi_dadd
 413              	.LVL38:
 104:Core/Src/PID.c ****     
 414              		.loc 1 104 5 is_stmt 1 view .LVU86
 104:Core/Src/PID.c ****     
 415              		.loc 1 104 14 is_stmt 0 view .LVU87
 416 0062 CDE90089 		strd	r8, [sp]
 417 0066 5246     		mov	r2, r10
 418 0068 5B46     		mov	r3, fp
ARM GAS  C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s 			page 11


 419 006a FFF7FEFF 		bl	PID_Limit
 420              	.LVL39:
 104:Core/Src/PID.c ****     
 421              		.loc 1 104 14 view .LVU88
 422 006e 8146     		mov	r9, r0
 423 0070 8846     		mov	r8, r1
 424              	.LVL40:
 106:Core/Src/PID.c ****     PID->previous_error = PID->error;
 425              		.loc 1 106 5 is_stmt 1 view .LVU89
 106:Core/Src/PID.c ****     PID->previous_error = PID->error;
 426              		.loc 1 106 48 is_stmt 0 view .LVU90
 427 0072 0022     		movs	r2, #0
 428 0074 0023     		movs	r3, #0
 429 0076 4846     		mov	r0, r9
 106:Core/Src/PID.c ****     PID->previous_error = PID->error;
 430              		.loc 1 106 48 view .LVU91
 431 0078 4146     		mov	r1, r8
 106:Core/Src/PID.c ****     PID->previous_error = PID->error;
 432              		.loc 1 106 48 view .LVU92
 433 007a FFF7FEFF 		bl	__aeabi_dcmplt
 434              	.LVL41:
 106:Core/Src/PID.c ****     PID->previous_error = PID->error;
 435              		.loc 1 106 48 view .LVU93
 436 007e 60B9     		cbnz	r0, .L31
 437              	.LVL42:
 438              	.L27:
 106:Core/Src/PID.c ****     PID->previous_error = PID->error;
 439              		.loc 1 106 23 discriminator 4 view .LVU94
 440 0080 4A46     		mov	r2, r9
 441 0082 4346     		mov	r3, r8
 442 0084 C5E90823 		strd	r2, [r5, #32]
 107:Core/Src/PID.c ****     PID->last_i = i_term;
 443              		.loc 1 107 5 is_stmt 1 discriminator 4 view .LVU95
 107:Core/Src/PID.c ****     PID->last_i = i_term;
 444              		.loc 1 107 30 is_stmt 0 discriminator 4 view .LVU96
 445 0088 D4E90623 		ldrd	r2, [r4, #24]
 107:Core/Src/PID.c ****     PID->last_i = i_term;
 446              		.loc 1 107 25 discriminator 4 view .LVU97
 447 008c C4E90823 		strd	r2, [r4, #32]
 108:Core/Src/PID.c **** }
 448              		.loc 1 108 5 is_stmt 1 discriminator 4 view .LVU98
 108:Core/Src/PID.c **** }
 449              		.loc 1 108 17 is_stmt 0 discriminator 4 view .LVU99
 450 0090 C4E90C67 		strd	r6, [r4, #48]
 109:Core/Src/PID.c **** 
 451              		.loc 1 109 1 discriminator 4 view .LVU100
 452 0094 07B0     		add	sp, sp, #28
 453              	.LCFI7:
 454              		.cfi_remember_state
 455              		.cfi_def_cfa_offset 36
 456              		@ sp needed
 457 0096 BDE8F08F 		pop	{r4, r5, r6, r7, r8, r9, r10, fp, pc}
 458              	.LVL43:
 459              	.L31:
 460              	.LCFI8:
 461              		.cfi_restore_state
 106:Core/Src/PID.c ****     PID->previous_error = PID->error;
ARM GAS  C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s 			page 12


 462              		.loc 1 106 48 discriminator 1 view .LVU101
 463 009a 08F10048 		add	r8, r8, #-2147483648
 464              	.LVL44:
 106:Core/Src/PID.c ****     PID->previous_error = PID->error;
 465              		.loc 1 106 48 discriminator 1 view .LVU102
 466 009e EFE7     		b	.L27
 467              		.cfi_endproc
 468              	.LFE69:
 470              		.global	__aeabi_dcmpeq
 471              		.global	__aeabi_d2uiz
 472              		.section	.text.PID_SetDuty,"ax",%progbits
 473              		.align	1
 474              		.global	PID_SetDuty
 475              		.syntax unified
 476              		.thumb
 477              		.thumb_func
 478              		.fpu softvfp
 480              	PID_SetDuty:
 481              	.LVL45:
 482              	.LFB71:
 127:Core/Src/PID.c **** 
 128:Core/Src/PID.c **** 
 129:Core/Src/PID.c **** 
 130:Core/Src/PID.c **** // PID_SetDuty(&(htimx->CCRx->CNT), MOTOR_TypeDef *motor)
 131:Core/Src/PID.c **** void PID_SetDuty(MOTOR_TypeDef *motor)
 132:Core/Src/PID.c **** {
 483              		.loc 1 132 1 is_stmt 1 view -0
 484              		.cfi_startproc
 485              		@ args = 0, pretend = 0, frame = 0
 486              		@ frame_needed = 0, uses_anonymous_args = 0
 487              		.loc 1 132 1 is_stmt 0 view .LVU104
 488 0000 10B5     		push	{r4, lr}
 489              	.LCFI9:
 490              		.cfi_def_cfa_offset 8
 491              		.cfi_offset 4, -8
 492              		.cfi_offset 14, -4
 493 0002 0446     		mov	r4, r0
 133:Core/Src/PID.c ****     if (motor->dir == 1)
 494              		.loc 1 133 5 is_stmt 1 view .LVU105
 495              		.loc 1 133 14 is_stmt 0 view .LVU106
 496 0004 90F82830 		ldrb	r3, [r0, #40]	@ zero_extendqisi2
 497              		.loc 1 133 8 view .LVU107
 498 0008 012B     		cmp	r3, #1
 499 000a 19D0     		beq	.L41
 134:Core/Src/PID.c ****     {
 135:Core/Src/PID.c ****         HAL_GPIO_WritePin(motor->GPIO, motor->DIR1_PIN, 0);
 136:Core/Src/PID.c ****         HAL_GPIO_WritePin(motor->GPIO, motor->DIR2_PIN, 1);
 137:Core/Src/PID.c ****     }
 138:Core/Src/PID.c ****     else 
 139:Core/Src/PID.c ****     {
 140:Core/Src/PID.c ****         HAL_GPIO_WritePin(motor->GPIO, motor->DIR1_PIN, 1);
 500              		.loc 1 140 9 is_stmt 1 view .LVU108
 501 000c 0122     		movs	r2, #1
 502 000e 418D     		ldrh	r1, [r0, #42]
 503 0010 406B     		ldr	r0, [r0, #52]
 504              	.LVL46:
 505              		.loc 1 140 9 is_stmt 0 view .LVU109
ARM GAS  C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s 			page 13


 506 0012 FFF7FEFF 		bl	HAL_GPIO_WritePin
 507              	.LVL47:
 141:Core/Src/PID.c ****         HAL_GPIO_WritePin(motor->GPIO, motor->DIR2_PIN, 0);  
 508              		.loc 1 141 9 is_stmt 1 view .LVU110
 509 0016 0022     		movs	r2, #0
 510 0018 A18D     		ldrh	r1, [r4, #44]
 511 001a 606B     		ldr	r0, [r4, #52]
 512 001c FFF7FEFF 		bl	HAL_GPIO_WritePin
 513              	.LVL48:
 514              	.L34:
 142:Core/Src/PID.c ****     }
 143:Core/Src/PID.c ****     if (motor->set_speed != 0)
 515              		.loc 1 143 5 view .LVU111
 516              		.loc 1 143 8 is_stmt 0 view .LVU112
 517 0020 0022     		movs	r2, #0
 518 0022 0023     		movs	r3, #0
 519 0024 D4E90201 		ldrd	r0, [r4, #8]
 520 0028 FFF7FEFF 		bl	__aeabi_dcmpeq
 521              	.LVL49:
 522 002c 98B9     		cbnz	r0, .L39
 144:Core/Src/PID.c ****     {
 145:Core/Src/PID.c ****         *(motor->PWM_ADDR) = round(motor->pwm_output);      
 523              		.loc 1 145 9 is_stmt 1 view .LVU113
 524              		.loc 1 145 30 is_stmt 0 view .LVU114
 525 002e D4E90801 		ldrd	r0, [r4, #32]
 526 0032 FFF7FEFF 		bl	round
 527              	.LVL50:
 528              		.loc 1 145 16 view .LVU115
 529 0036 A46B     		ldr	r4, [r4, #56]
 530              	.LVL51:
 531              		.loc 1 145 28 view .LVU116
 532 0038 FFF7FEFF 		bl	__aeabi_d2uiz
 533              	.LVL52:
 534 003c 2060     		str	r0, [r4]
 535              	.L32:
 146:Core/Src/PID.c ****     }
 147:Core/Src/PID.c ****     else
 148:Core/Src/PID.c ****     {
 149:Core/Src/PID.c ****         // HAL_GPIO_WritePin(motor->GPIO, motor->DIR1_PIN, 0);
 150:Core/Src/PID.c ****         // HAL_GPIO_WritePin(motor->GPIO, motor->DIR2_PIN, 0);
 151:Core/Src/PID.c ****         *(motor->PWM_ADDR) = 0;
 152:Core/Src/PID.c ****     }
 153:Core/Src/PID.c ****     
 154:Core/Src/PID.c **** }
 536              		.loc 1 154 1 view .LVU117
 537 003e 10BD     		pop	{r4, pc}
 538              	.LVL53:
 539              	.L41:
 135:Core/Src/PID.c ****         HAL_GPIO_WritePin(motor->GPIO, motor->DIR2_PIN, 1);
 540              		.loc 1 135 9 is_stmt 1 view .LVU118
 541 0040 0022     		movs	r2, #0
 542 0042 418D     		ldrh	r1, [r0, #42]
 543 0044 406B     		ldr	r0, [r0, #52]
 544              	.LVL54:
 135:Core/Src/PID.c ****         HAL_GPIO_WritePin(motor->GPIO, motor->DIR2_PIN, 1);
 545              		.loc 1 135 9 is_stmt 0 view .LVU119
 546 0046 FFF7FEFF 		bl	HAL_GPIO_WritePin
ARM GAS  C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s 			page 14


 547              	.LVL55:
 136:Core/Src/PID.c ****     }
 548              		.loc 1 136 9 is_stmt 1 view .LVU120
 549 004a 0122     		movs	r2, #1
 550 004c A18D     		ldrh	r1, [r4, #44]
 551 004e 606B     		ldr	r0, [r4, #52]
 552 0050 FFF7FEFF 		bl	HAL_GPIO_WritePin
 553              	.LVL56:
 554 0054 E4E7     		b	.L34
 555              	.L39:
 151:Core/Src/PID.c ****     }
 556              		.loc 1 151 9 view .LVU121
 151:Core/Src/PID.c ****     }
 557              		.loc 1 151 16 is_stmt 0 view .LVU122
 558 0056 A36B     		ldr	r3, [r4, #56]
 151:Core/Src/PID.c ****     }
 559              		.loc 1 151 28 view .LVU123
 560 0058 0022     		movs	r2, #0
 561 005a 1A60     		str	r2, [r3]
 562              		.loc 1 154 1 view .LVU124
 563 005c EFE7     		b	.L32
 564              		.cfi_endproc
 565              	.LFE71:
 567              		.section	.text.PID_SetTunings,"ax",%progbits
 568              		.align	1
 569              		.global	PID_SetTunings
 570              		.syntax unified
 571              		.thumb
 572              		.thumb_func
 573              		.fpu softvfp
 575              	PID_SetTunings:
 576              	.LVL57:
 577              	.LFB72:
 155:Core/Src/PID.c **** 
 156:Core/Src/PID.c **** 
 157:Core/Src/PID.c **** void PID_SetTunings(PID_TypeDef *pPID_Params, double setKp, double setKi, double setKd)
 158:Core/Src/PID.c **** {
 578              		.loc 1 158 1 is_stmt 1 view -0
 579              		.cfi_startproc
 580              		@ args = 16, pretend = 0, frame = 0
 581              		@ frame_needed = 0, uses_anonymous_args = 0
 582              		@ link register save eliminated.
 159:Core/Src/PID.c ****     pPID_Params->Kp = setKp;
 583              		.loc 1 159 5 view .LVU126
 584              		.loc 1 159 21 is_stmt 0 view .LVU127
 585 0000 C0E90023 		strd	r2, [r0]
 160:Core/Src/PID.c ****     pPID_Params->Ki = setKi;
 586              		.loc 1 160 5 is_stmt 1 view .LVU128
 587              		.loc 1 160 21 is_stmt 0 view .LVU129
 588 0004 DDE90023 		ldrd	r2, [sp]
 589              	.LVL58:
 590              		.loc 1 160 21 view .LVU130
 591 0008 C0E90423 		strd	r2, [r0, #16]
 161:Core/Src/PID.c ****     pPID_Params->Kd = setKd;
 592              		.loc 1 161 5 is_stmt 1 view .LVU131
 593              		.loc 1 161 21 is_stmt 0 view .LVU132
 594 000c DDE90223 		ldrd	r2, [sp, #8]
ARM GAS  C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s 			page 15


 595 0010 C0E90223 		strd	r2, [r0, #8]
 162:Core/Src/PID.c **** }
 596              		.loc 1 162 1 view .LVU133
 597 0014 7047     		bx	lr
 598              		.cfi_endproc
 599              	.LFE72:
 601              		.section	.text.PID_MotorInit,"ax",%progbits
 602              		.align	1
 603              		.global	PID_MotorInit
 604              		.syntax unified
 605              		.thumb
 606              		.thumb_func
 607              		.fpu softvfp
 609              	PID_MotorInit:
 610              	.LVL59:
 611              	.LFB73:
 163:Core/Src/PID.c **** 
 164:Core/Src/PID.c **** 
 165:Core/Src/PID.c **** // Init GPIOs and PID params that relevant to motor.
 166:Core/Src/PID.c **** void PID_MotorInit( MOTOR_TypeDef *motor,               // Motor str address
 167:Core/Src/PID.c ****                     PID_TypeDef *pPID_Params,           // PID str address
 168:Core/Src/PID.c ****                     GPIO_TypeDef* PORT,                 // GPIO PORT for direction control
 169:Core/Src/PID.c ****                     uint16_t PIN1,                      // GPIO PINS for direction control
 170:Core/Src/PID.c ****                     uint16_t PIN2,                      // GPIO PINS for direction control
 171:Core/Src/PID.c ****                     double max_output,                  // Max Output of PWM
 172:Core/Src/PID.c ****                     double min_output,                  // Min Input of PWM
 173:Core/Src/PID.c ****                     volatile uint32_t * TIM_ENC_ADDR,   // TIMER interfacing encoder's counter regi
 174:Core/Src/PID.c ****                     volatile uint32_t * TIM_PWM_ADDR,   // TIMER Capture and Compare Register addre
 175:Core/Src/PID.c ****                     double* pSet_Params)                // Set PID parameters array
 176:Core/Src/PID.c **** {
 612              		.loc 1 176 1 is_stmt 1 view -0
 613              		.cfi_startproc
 614              		@ args = 36, pretend = 0, frame = 0
 615              		@ frame_needed = 0, uses_anonymous_args = 0
 616              		.loc 1 176 1 is_stmt 0 view .LVU135
 617 0000 2DE9F041 		push	{r4, r5, r6, r7, r8, lr}
 618              	.LCFI10:
 619              		.cfi_def_cfa_offset 24
 620              		.cfi_offset 4, -24
 621              		.cfi_offset 5, -20
 622              		.cfi_offset 6, -16
 623              		.cfi_offset 7, -12
 624              		.cfi_offset 8, -8
 625              		.cfi_offset 14, -4
 626 0004 84B0     		sub	sp, sp, #16
 627              	.LCFI11:
 628              		.cfi_def_cfa_offset 40
 629 0006 0446     		mov	r4, r0
 630 0008 0D46     		mov	r5, r1
 631 000a 9046     		mov	r8, r2
 632 000c 1F46     		mov	r7, r3
 633 000e 129E     		ldr	r6, [sp, #72]
 177:Core/Src/PID.c **** 
 178:Core/Src/PID.c ****     #ifndef __GPIO_H__
 179:Core/Src/PID.c ****     GPIO_InitTypeDef GPIO_InitStruct = {0};
 180:Core/Src/PID.c **** 
 181:Core/Src/PID.c ****     GPIO_InitStruct.Pin = PIN1 | PIN2;
ARM GAS  C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s 			page 16


 182:Core/Src/PID.c ****     GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
 183:Core/Src/PID.c ****     GPIO_InitStruct.Pull = GPIO_PULLUP;
 184:Core/Src/PID.c ****     GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_HIGH;
 185:Core/Src/PID.c ****     HAL_GPIO_Init(PORT, &GPIO_InitStruct);
 186:Core/Src/PID.c ****     #endif
 187:Core/Src/PID.c **** 
 188:Core/Src/PID.c ****     memset(pPID_Params , 0, sizeof(PID_TypeDef) );
 634              		.loc 1 188 5 is_stmt 1 view .LVU136
 635 0010 5022     		movs	r2, #80
 636              	.LVL60:
 637              		.loc 1 188 5 is_stmt 0 view .LVU137
 638 0012 0021     		movs	r1, #0
 639              	.LVL61:
 640              		.loc 1 188 5 view .LVU138
 641 0014 2846     		mov	r0, r5
 642              	.LVL62:
 643              		.loc 1 188 5 view .LVU139
 644 0016 FFF7FEFF 		bl	memset
 645              	.LVL63:
 189:Core/Src/PID.c **** 
 190:Core/Src/PID.c ****     motor->pPID_params = pPID_Params;
 646              		.loc 1 190 5 is_stmt 1 view .LVU140
 647              		.loc 1 190 24 is_stmt 0 view .LVU141
 648 001a 2563     		str	r5, [r4, #48]
 191:Core/Src/PID.c ****     motor->GPIO = PORT;
 649              		.loc 1 191 5 is_stmt 1 view .LVU142
 650              		.loc 1 191 17 is_stmt 0 view .LVU143
 651 001c C4F83480 		str	r8, [r4, #52]
 192:Core/Src/PID.c ****     motor->DIR1_PIN = PIN1;
 652              		.loc 1 192 5 is_stmt 1 view .LVU144
 653              		.loc 1 192 21 is_stmt 0 view .LVU145
 654 0020 6785     		strh	r7, [r4, #42]	@ movhi
 193:Core/Src/PID.c ****     motor->DIR2_PIN = PIN2;
 655              		.loc 1 193 5 is_stmt 1 view .LVU146
 656              		.loc 1 193 21 is_stmt 0 view .LVU147
 657 0022 BDF82830 		ldrh	r3, [sp, #40]
 658 0026 A385     		strh	r3, [r4, #44]	@ movhi
 194:Core/Src/PID.c **** 
 195:Core/Src/PID.c ****     motor->dir = 1;
 659              		.loc 1 195 5 is_stmt 1 view .LVU148
 660              		.loc 1 195 16 is_stmt 0 view .LVU149
 661 0028 0123     		movs	r3, #1
 662 002a 84F82830 		strb	r3, [r4, #40]
 196:Core/Src/PID.c **** 
 197:Core/Src/PID.c ****     motor->ENC_ADDR = TIM_ENC_ADDR;
 663              		.loc 1 197 5 is_stmt 1 view .LVU150
 664              		.loc 1 197 21 is_stmt 0 view .LVU151
 665 002e 109B     		ldr	r3, [sp, #64]
 666 0030 E363     		str	r3, [r4, #60]
 198:Core/Src/PID.c ****     motor->PWM_ADDR = TIM_PWM_ADDR;
 667              		.loc 1 198 5 is_stmt 1 view .LVU152
 668              		.loc 1 198 21 is_stmt 0 view .LVU153
 669 0032 119B     		ldr	r3, [sp, #68]
 670 0034 A363     		str	r3, [r4, #56]
 199:Core/Src/PID.c **** 
 200:Core/Src/PID.c ****     pPID_Params->OUTPUT_MAX = max_output;
 671              		.loc 1 200 5 is_stmt 1 view .LVU154
ARM GAS  C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s 			page 17


 672              		.loc 1 200 29 is_stmt 0 view .LVU155
 673 0036 DDE90C23 		ldrd	r2, [sp, #48]
 674 003a C5E91023 		strd	r2, [r5, #64]
 201:Core/Src/PID.c ****     pPID_Params->OUTPUT_MIN = min_output;
 675              		.loc 1 201 5 is_stmt 1 view .LVU156
 676              		.loc 1 201 29 is_stmt 0 view .LVU157
 677 003e DDE90E23 		ldrd	r2, [sp, #56]
 678 0042 C5E91223 		strd	r2, [r5, #72]
 202:Core/Src/PID.c **** 
 203:Core/Src/PID.c ****     PID_SetTunings(pPID_Params, pSet_Params[0] , pSet_Params[1], pSet_Params[2]);
 679              		.loc 1 203 5 is_stmt 1 view .LVU158
 680 0046 D6E90423 		ldrd	r2, [r6, #16]
 681 004a CDE90223 		strd	r2, [sp, #8]
 682 004e D6E90223 		ldrd	r2, [r6, #8]
 683 0052 CDE90023 		strd	r2, [sp]
 684 0056 D6E90023 		ldrd	r2, [r6]
 685 005a 2846     		mov	r0, r5
 686 005c FFF7FEFF 		bl	PID_SetTunings
 687              	.LVL64:
 204:Core/Src/PID.c **** }
 688              		.loc 1 204 1 is_stmt 0 view .LVU159
 689 0060 04B0     		add	sp, sp, #16
 690              	.LCFI12:
 691              		.cfi_def_cfa_offset 24
 692              		@ sp needed
 693 0062 BDE8F081 		pop	{r4, r5, r6, r7, r8, pc}
 694              		.loc 1 204 1 view .LVU160
 695              		.cfi_endproc
 696              	.LFE73:
 698              		.section	.text.PID_FirstOrderFilter,"ax",%progbits
 699              		.align	1
 700              		.global	PID_FirstOrderFilter
 701              		.syntax unified
 702              		.thumb
 703              		.thumb_func
 704              		.fpu softvfp
 706              	PID_FirstOrderFilter:
 707              	.LVL65:
 708              	.LFB74:
 205:Core/Src/PID.c **** 
 206:Core/Src/PID.c **** 
 207:Core/Src/PID.c **** // Note: Nothing
 208:Core/Src/PID.c **** double PID_FirstOrderFilter(double raw_sig, double last_filtered_sig, double a)
 209:Core/Src/PID.c **** {
 709              		.loc 1 209 1 is_stmt 1 view -0
 710              		.cfi_startproc
 711              		@ args = 8, pretend = 0, frame = 0
 712              		@ frame_needed = 0, uses_anonymous_args = 0
 713              		.loc 1 209 1 is_stmt 0 view .LVU162
 714 0000 2DE9F843 		push	{r3, r4, r5, r6, r7, r8, r9, lr}
 715              	.LCFI13:
 716              		.cfi_def_cfa_offset 32
 717              		.cfi_offset 3, -32
 718              		.cfi_offset 4, -28
 719              		.cfi_offset 5, -24
 720              		.cfi_offset 6, -20
 721              		.cfi_offset 7, -16
ARM GAS  C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s 			page 18


 722              		.cfi_offset 8, -12
 723              		.cfi_offset 9, -8
 724              		.cfi_offset 14, -4
 725 0004 0646     		mov	r6, r0
 726 0006 0F46     		mov	r7, r1
 727 0008 DDE90889 		ldrd	r8, [sp, #32]
 210:Core/Src/PID.c ****     return  (a * last_filtered_sig +  (1-a) * raw_sig);
 728              		.loc 1 210 5 is_stmt 1 view .LVU163
 729              		.loc 1 210 16 is_stmt 0 view .LVU164
 730 000c 4046     		mov	r0, r8
 731              	.LVL66:
 732              		.loc 1 210 16 view .LVU165
 733 000e 4946     		mov	r1, r9
 734 0010 FFF7FEFF 		bl	__aeabi_dmul
 735              	.LVL67:
 736              		.loc 1 210 16 view .LVU166
 737 0014 0446     		mov	r4, r0
 738 0016 0D46     		mov	r5, r1
 739              		.loc 1 210 41 view .LVU167
 740 0018 4246     		mov	r2, r8
 741 001a 4B46     		mov	r3, r9
 742 001c 0020     		movs	r0, #0
 743 001e 0749     		ldr	r1, .L47
 744 0020 FFF7FEFF 		bl	__aeabi_dsub
 745              	.LVL68:
 746              		.loc 1 210 45 view .LVU168
 747 0024 3246     		mov	r2, r6
 748 0026 3B46     		mov	r3, r7
 749 0028 FFF7FEFF 		bl	__aeabi_dmul
 750              	.LVL69:
 751 002c 0246     		mov	r2, r0
 752 002e 0B46     		mov	r3, r1
 753              		.loc 1 210 36 view .LVU169
 754 0030 2046     		mov	r0, r4
 755 0032 2946     		mov	r1, r5
 756 0034 FFF7FEFF 		bl	__aeabi_dadd
 757              	.LVL70:
 211:Core/Src/PID.c **** }
 758              		.loc 1 211 1 view .LVU170
 759 0038 BDE8F883 		pop	{r3, r4, r5, r6, r7, r8, r9, pc}
 760              	.LVL71:
 761              	.L48:
 762              		.loc 1 211 1 view .LVU171
 763              		.align	2
 764              	.L47:
 765 003c 0000F03F 		.word	1072693248
 766              		.cfi_endproc
 767              	.LFE74:
 769              		.global	__aeabi_ui2d
 770              		.section	.text.PID_PreProcess,"ax",%progbits
 771              		.align	1
 772              		.global	PID_PreProcess
 773              		.syntax unified
 774              		.thumb
 775              		.thumb_func
 776              		.fpu softvfp
 778              	PID_PreProcess:
ARM GAS  C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s 			page 19


 779              	.LVL72:
 780              	.LFB75:
 212:Core/Src/PID.c **** 
 213:Core/Src/PID.c **** 
 214:Core/Src/PID.c **** // Do sampling and computing speed in RPM and PID Error
 215:Core/Src/PID.c **** void PID_PreProcess(MOTOR_TypeDef *motor, double _set_speed)
 216:Core/Src/PID.c **** {
 781              		.loc 1 216 1 is_stmt 1 view -0
 782              		.cfi_startproc
 783              		@ args = 0, pretend = 0, frame = 0
 784              		@ frame_needed = 0, uses_anonymous_args = 0
 785              		.loc 1 216 1 is_stmt 0 view .LVU173
 786 0000 2DE9F04F 		push	{r4, r5, r6, r7, r8, r9, r10, fp, lr}
 787              	.LCFI14:
 788              		.cfi_def_cfa_offset 36
 789              		.cfi_offset 4, -36
 790              		.cfi_offset 5, -32
 791              		.cfi_offset 6, -28
 792              		.cfi_offset 7, -24
 793              		.cfi_offset 8, -20
 794              		.cfi_offset 9, -16
 795              		.cfi_offset 10, -12
 796              		.cfi_offset 11, -8
 797              		.cfi_offset 14, -4
 798 0004 83B0     		sub	sp, sp, #12
 799              	.LCFI15:
 800              		.cfi_def_cfa_offset 48
 801 0006 0446     		mov	r4, r0
 802 0008 9046     		mov	r8, r2
 803 000a 9946     		mov	r9, r3
 217:Core/Src/PID.c **** 
 218:Core/Src/PID.c ****     // Sampling: get ticks at the same time with getting encoder pos
 219:Core/Src/PID.c ****     uint32_t enc_cnt = *(motor->ENC_ADDR); // Similar to enc_cnt = TIMx->CNT
 804              		.loc 1 219 5 is_stmt 1 view .LVU174
 805              		.loc 1 219 31 is_stmt 0 view .LVU175
 806 000c C36B     		ldr	r3, [r0, #60]
 807              		.loc 1 219 14 view .LVU176
 808 000e D3F800B0 		ldr	fp, [r3]
 809              	.LVL73:
 220:Core/Src/PID.c ****     uint32_t tick = HAL_GetTick();
 810              		.loc 1 220 5 is_stmt 1 view .LVU177
 811              		.loc 1 220 21 is_stmt 0 view .LVU178
 812 0012 FFF7FEFF 		bl	HAL_GetTick
 813              	.LVL74:
 814              		.loc 1 220 21 view .LVU179
 815 0016 0546     		mov	r5, r0
 816              	.LVL75:
 221:Core/Src/PID.c ****     // End of sampling
 222:Core/Src/PID.c **** 
 223:Core/Src/PID.c ****     uint32_t d_tick = tick - motor->last_tick; // Calc the derivative of time
 817              		.loc 1 223 5 is_stmt 1 view .LVU180
 818              		.loc 1 223 35 is_stmt 0 view .LVU181
 819 0018 A369     		ldr	r3, [r4, #24]
 820              	.LVL76:
 224:Core/Src/PID.c ****     if (d_tick <= 0) d_tick = 10;
 821              		.loc 1 224 5 is_stmt 1 view .LVU182
 822              		.loc 1 224 8 is_stmt 0 view .LVU183
ARM GAS  C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s 			page 20


 823 001a B0EB030A 		subs	r10, r0, r3
 824              	.LVL77:
 825              		.loc 1 224 8 view .LVU184
 826 001e 01D1     		bne	.L50
 827              		.loc 1 224 29 view .LVU185
 828 0020 4FF00A0A 		mov	r10, #10
 829              	.LVL78:
 830              	.L50:
 225:Core/Src/PID.c **** 
 226:Core/Src/PID.c ****     uint32_t last_enc_cnt = motor->last_enc_cnt;
 831              		.loc 1 226 5 is_stmt 1 view .LVU186
 832              		.loc 1 226 14 is_stmt 0 view .LVU187
 833 0024 E069     		ldr	r0, [r4, #28]
 834              	.LVL79:
 227:Core/Src/PID.c **** 
 228:Core/Src/PID.c ****     double d_measure = (enc_cnt>last_enc_cnt) ? (enc_cnt-last_enc_cnt) : (last_enc_cnt-enc_cnt);
 835              		.loc 1 228 5 is_stmt 1 view .LVU188
 836              		.loc 1 228 12 is_stmt 0 view .LVU189
 837 0026 8345     		cmp	fp, r0
 838 0028 2CD9     		bls	.L51
 839              		.loc 1 228 12 discriminator 1 view .LVU190
 840 002a ABEB0000 		sub	r0, fp, r0
 841              	.LVL80:
 842              		.loc 1 228 12 discriminator 1 view .LVU191
 843 002e FFF7FEFF 		bl	__aeabi_ui2d
 844              	.LVL81:
 845              		.loc 1 228 12 discriminator 1 view .LVU192
 846 0032 0646     		mov	r6, r0
 847 0034 0F46     		mov	r7, r1
 848              	.L52:
 849              	.LVL82:
 229:Core/Src/PID.c ****     // Handle overflow or underflow of encoder interfacing timer
 230:Core/Src/PID.c ****     if (d_measure > 50) d_measure = motor->measure;
 850              		.loc 1 230 5 is_stmt 1 discriminator 4 view .LVU193
 851              		.loc 1 230 8 is_stmt 0 discriminator 4 view .LVU194
 852 0036 0022     		movs	r2, #0
 853 0038 164B     		ldr	r3, .L58
 854 003a 3046     		mov	r0, r6
 855 003c 3946     		mov	r1, r7
 856 003e FFF7FEFF 		bl	__aeabi_dcmpgt
 857              	.LVL83:
 858 0042 08B1     		cbz	r0, .L53
 859              		.loc 1 230 25 is_stmt 1 discriminator 1 view .LVU195
 860              		.loc 1 230 35 is_stmt 0 discriminator 1 view .LVU196
 861 0044 D4E90467 		ldrd	r6, [r4, #16]
 862              	.LVL84:
 863              	.L53:
 231:Core/Src/PID.c ****     // Filter the measurement
 232:Core/Src/PID.c ****     d_measure  = PID_FirstOrderFilter(d_measure, motor->measure, _1ST_FILTER_ALPHA);
 864              		.loc 1 232 5 is_stmt 1 view .LVU197
 865              		.loc 1 232 18 is_stmt 0 view .LVU198
 866 0048 0022     		movs	r2, #0
 867 004a 134B     		ldr	r3, .L58+4
 868 004c CDE90023 		strd	r2, [sp]
 869 0050 D4E90423 		ldrd	r2, [r4, #16]
 870 0054 3046     		mov	r0, r6
 871 0056 3946     		mov	r1, r7
ARM GAS  C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s 			page 21


 872 0058 FFF7FEFF 		bl	PID_FirstOrderFilter
 873              	.LVL85:
 233:Core/Src/PID.c **** 
 234:Core/Src/PID.c ****     motor->measure = d_measure;
 874              		.loc 1 234 5 is_stmt 1 view .LVU199
 875              		.loc 1 234 20 is_stmt 0 view .LVU200
 876 005c C4E90401 		strd	r0, [r4, #16]
 235:Core/Src/PID.c **** 
 236:Core/Src/PID.c ****     PID_ComputeSpeedRPM( motor, d_tick );
 877              		.loc 1 236 5 is_stmt 1 view .LVU201
 878 0060 5146     		mov	r1, r10
 879 0062 2046     		mov	r0, r4
 880              	.LVL86:
 881              		.loc 1 236 5 is_stmt 0 view .LVU202
 882 0064 FFF7FEFF 		bl	PID_ComputeSpeedRPM
 883              	.LVL87:
 237:Core/Src/PID.c ****     PID_SetSpeedRPM( motor , _set_speed );
 884              		.loc 1 237 5 is_stmt 1 view .LVU203
 885 0068 4246     		mov	r2, r8
 886 006a 4B46     		mov	r3, r9
 887 006c 2046     		mov	r0, r4
 888 006e FFF7FEFF 		bl	PID_SetSpeedRPM
 889              	.LVL88:
 238:Core/Src/PID.c ****     PID_ComputeError( motor );
 890              		.loc 1 238 5 view .LVU204
 891 0072 2046     		mov	r0, r4
 892 0074 FFF7FEFF 		bl	PID_ComputeError
 893              	.LVL89:
 239:Core/Src/PID.c ****  
 240:Core/Src/PID.c ****     motor->last_tick = tick;
 894              		.loc 1 240 5 view .LVU205
 895              		.loc 1 240 22 is_stmt 0 view .LVU206
 896 0078 A561     		str	r5, [r4, #24]
 241:Core/Src/PID.c ****     motor->last_enc_cnt = enc_cnt;
 897              		.loc 1 241 5 is_stmt 1 view .LVU207
 898              		.loc 1 241 25 is_stmt 0 view .LVU208
 899 007a C4F81CB0 		str	fp, [r4, #28]
 242:Core/Src/PID.c **** 
 243:Core/Src/PID.c **** }
 900              		.loc 1 243 1 view .LVU209
 901 007e 03B0     		add	sp, sp, #12
 902              	.LCFI16:
 903              		.cfi_remember_state
 904              		.cfi_def_cfa_offset 36
 905              		@ sp needed
 906 0080 BDE8F08F 		pop	{r4, r5, r6, r7, r8, r9, r10, fp, pc}
 907              	.LVL90:
 908              	.L51:
 909              	.LCFI17:
 910              		.cfi_restore_state
 228:Core/Src/PID.c ****     // Handle overflow or underflow of encoder interfacing timer
 911              		.loc 1 228 12 discriminator 2 view .LVU210
 912 0084 A0EB0B00 		sub	r0, r0, fp
 913              	.LVL91:
 228:Core/Src/PID.c ****     // Handle overflow or underflow of encoder interfacing timer
 914              		.loc 1 228 12 discriminator 2 view .LVU211
 915 0088 FFF7FEFF 		bl	__aeabi_ui2d
ARM GAS  C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s 			page 22


 916              	.LVL92:
 228:Core/Src/PID.c ****     // Handle overflow or underflow of encoder interfacing timer
 917              		.loc 1 228 12 discriminator 2 view .LVU212
 918 008c 0646     		mov	r6, r0
 919 008e 0F46     		mov	r7, r1
 920 0090 D1E7     		b	.L52
 921              	.L59:
 922 0092 00BF     		.align	2
 923              	.L58:
 924 0094 00004940 		.word	1078525952
 925 0098 0000E03F 		.word	1071644672
 926              		.cfi_endproc
 927              	.LFE75:
 929              		.text
 930              	.Letext0:
 931              		.file 2 "c:\\program files (x86)\\gnu arm embedded toolchain\\10 2020-q4-major\\arm-none-eabi\\inc
 932              		.file 3 "c:\\program files (x86)\\gnu arm embedded toolchain\\10 2020-q4-major\\arm-none-eabi\\inc
 933              		.file 4 "Drivers/CMSIS/Device/ST/STM32F1xx/Include/stm32f103xb.h"
 934              		.file 5 "Core/Inc/PID.h"
 935              		.file 6 "Drivers/STM32F1xx_HAL_Driver/Inc/stm32f1xx_hal.h"
 936              		.file 7 "Drivers/STM32F1xx_HAL_Driver/Inc/stm32f1xx_hal_gpio.h"
 937              		.file 8 "c:\\program files (x86)\\gnu arm embedded toolchain\\10 2020-q4-major\\arm-none-eabi\\inc
 938              		.file 9 "<built-in>"
ARM GAS  C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s 			page 23


DEFINED SYMBOLS
                            *ABS*:00000000 PID.c
C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s:21     .text.PID_ComputeSpeedRPM:00000000 $t
C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s:29     .text.PID_ComputeSpeedRPM:00000000 PID_ComputeSpeedRPM
C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s:82     .text.PID_ComputeSpeedRPM:00000038 $d
C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s:90     .text.PID_SetSpeedRPM:00000000 $t
C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s:97     .text.PID_SetSpeedRPM:00000000 PID_SetSpeedRPM
C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s:157    .text.PID_SetSpeedMPS:00000000 $t
C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s:164    .text.PID_SetSpeedMPS:00000000 PID_SetSpeedMPS
C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s:205    .text.PID_SetSpeedMPS:00000028 $d
C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s:213    .text.PID_ComputeError:00000000 $t
C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s:220    .text.PID_ComputeError:00000000 PID_ComputeError
C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s:255    .text.PID_Limit:00000000 $t
C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s:262    .text.PID_Limit:00000000 PID_Limit
C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s:318    .text.PID_ComputeOutput:00000000 $t
C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s:325    .text.PID_ComputeOutput:00000000 PID_ComputeOutput
C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s:473    .text.PID_SetDuty:00000000 $t
C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s:480    .text.PID_SetDuty:00000000 PID_SetDuty
C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s:568    .text.PID_SetTunings:00000000 $t
C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s:575    .text.PID_SetTunings:00000000 PID_SetTunings
C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s:602    .text.PID_MotorInit:00000000 $t
C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s:609    .text.PID_MotorInit:00000000 PID_MotorInit
C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s:699    .text.PID_FirstOrderFilter:00000000 $t
C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s:706    .text.PID_FirstOrderFilter:00000000 PID_FirstOrderFilter
C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s:765    .text.PID_FirstOrderFilter:0000003c $d
C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s:771    .text.PID_PreProcess:00000000 $t
C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s:778    .text.PID_PreProcess:00000000 PID_PreProcess
C:\Users\Duy_Linh\AppData\Local\Temp\ccqzO9pM.s:924    .text.PID_PreProcess:00000094 $d

UNDEFINED SYMBOLS
__aeabi_ui2f
__aeabi_fmul
__aeabi_f2d
__aeabi_ddiv
__aeabi_dmul
__aeabi_dcmpge
__aeabi_i2d
__aeabi_dsub
__aeabi_dcmpgt
__aeabi_dcmplt
__aeabi_dadd
__aeabi_dcmpeq
__aeabi_d2uiz
HAL_GPIO_WritePin
round
memset
__aeabi_ui2d
HAL_GetTick
